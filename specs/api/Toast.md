<!-- Copyright 2020 Adobe. All rights reserved.
This file is licensed to you under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License. You may obtain a copy
of the License at http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software distributed under
the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS
OF ANY KIND, either express or implied. See the License for the specific language
governing permissions and limitations under the License. -->

## Introduction

This document outlines the API for the Toast component to be implemented in React Spectrum v3. A major update from previous iterations is the concept of a Toast [queue](https://spectrum.adobe.com/page/toast/#Priority-queue). Additionally, an effort has been made to create an API that meshes with the React Hooks concept, allow us to provide aria and stately hooks for outside use in custom Toast components.

## Toast API
```typescript
interface ToastProps {
  // Variant of the toast, default is 'neutral'.
  variant?: 'neutral' | 'informative' | 'positive' | 'negative',

  // Whether or not the toast is closable via a 'x' button. Note: this is a carry over from previous versions.
  isDismissible?: boolean,

  // Callback when toast is dismissed.
  onDismiss? () => void,

  // Sets how long the toast remains on screen before being automatically dismissed. If undefined, the toast remains indefinitely.
  autoDismissDuration? number,

  // The contents of the toast.
  children: ReactNode,

  // The label for the optional action button.
  actionLabel?: ReactNode,

  // Callback triggered when toast action button is pressed.
  onAction? () => void,

  // Unique identifier for the toast, autogenerated if not provided by the user.
  key?: string,

  // Callback  triggered when the toast has fully transitioned out
  onExit?: () => void
}

interface ToastAria {
  // Props for the Toast div (e.g. role="alert").
  toastProps: HTMLAttributes<HTMLDivElement>,

  // Props for close button (e.g. aria-label = "close", press handlers that call props.onDismiss).
  closeButtonProps: ButtonHTMLAttributes<HTMLButtonElement>,

  // Props for action button (e.g. press handlers that call props.onAction)
  actionButtonProps: ButtonHTMLAttributes<HTMLButtonElement>
}

function useToast(props: ToastProps, state: ToastState): ToastAria;
```

## ToastContainer API

The core approach to handle queuing is as follows:

- Setup a global state that tracks what toast is visible, what toasts are in queue, and contains functions for adding/removing toasts.
  - This state would be provided by a `useToastContainerState` hook and made available to child components via context.
- A spectrum component called `ToastContainer` would be made available for `@react-spectrum` package consumers. It would sets up a context to provide this global state to all children
    - This component would need to be high up in the component tree (i.e. Provider level) so that the context would be available to components that may want to add a Toast to the queue.
      - Sample usage: `state.addToast(<Toast variant='warning'...>)`

```typescript
interface ToastContainerProps {
  /**
    Some prop that allow the user to specify where the container should be located on the page. Open questions are as follows:
      - Where to position the ToastContainer? Would the toast appear at the bottom of the container it was placed in or portalled out so it is at the bottom of the screen?
        - Should there be an option to portal?

      - How would this affect theming? Would we get the theme from the nearest container or should it receive the theming from the top most Provider?
  **/
  positioning: ?
}


interface ToastContainerState {
  // Returns what toast is currently displayed.
  visibleToast: ToastElement,

  // Setter for what toast to display. Returned here in case user wants to ignore priority logic and set what toast should be visible.
  setVisibleToastProps: (ToastElement) => void,

  // Flat array that contains the current toast queue.
  toastQueue: Array<ToastElement>,

  // Setter to modify toast queue. Returned here if the user want to modify the queue directly (wipe the queue, etc).
  setToastQueue: (Array<ToastElement>) => void,

  // Adds a toast to the queue. Needs a unique identifier so toast look up can happen via removeToast.
  addToast: (ToastElement, id/key) => void

  // Removes a toast regardless if it is visible or in queue. Uses the provided id/key to match what toast to remove.
  removeToast: (id/key) => void
}

 - perhaps a way to customize toast priority logic is added here
// Function that overrides the default priority logic. Consumes toast props and returns a priority number
  determinePriorityFn: (props) => number

function useToastContainerState(): ToastContainerState;


interface ToastContainerAria {
  // The
  role: 'region',
  aria-label: 'Notifications'
}

function useToastContainer(): ToastContainerAria;
```




## Use Cases

- stuff found in the rsp room
  - have toast last an indefinite amount of time (has progress bar inside it)
  - show toast after an operation finishes (upload complete, form saved etc)
    - also for error messaging (but not form validation)
  - lotta requests for help positioning it
- v2 stories (support the same stuff available there?)
- https://git.corp.adobe.com/io-sdk/willow/blob/492f02a527c1de111f9ea4246c262360f70684a1/src/components/AppsPage/AppsPageLayout.js
  - toast appears to notify iOS support and other info
- https://git.corp.adobe.com/adobe-platform/ethos-homepage/blob/4327571c748e17f34af603246e8ec88e82b73397/comps/featurecomps/AddNewFlag.tsx
  - notification toast for feature flag creation success and failure (validation)
- https://git.corp.adobe.com/di-services-3d/dncr-gltf-viewer/blob/5344620e96e4e1d14587cbb749df58130bca1418/src/AbuseForm.js
  - notification (success or failure) for abuse report submission
- https://git.corp.adobe.com/aem-eng-ops/aem-headcount/blob/14275b2f4c4ca9ccb7c4f5eeea45dfdad1668b95/ui/src/views/login/Login.js
  - error toast for authentication

## Research
- looked at MaterialUI, Ant, and ReactBootstrap
- similar api for the most part
  - some form of variant, timeout, onClose, positioning handling, transition customization, message customization
- Ant has users render the toast (called "notification" by them) via `notification.[variant](config)` instead of the typical <Toast /> format. Also no controlled 'open/show' prop
  - MaterialUI and ReactBootstrap were more "normal", e.g. <Toast /> + having a "show/open" prop
- none of them really handled queuing or making sure only a single toast was rendered at a time
  - up to user to handle that behavior

## Open Questions

- Where is the line drawn for spectrum behavior here?
  - is it the queue logic (aka the 1 through 8 priority), or is it the fact that there is a queue at all and we disallow displaying more than one toast at a time
    - how much customization would we want to allow for priority logic/bypassing said logic
- how flexible do we want toast customization to be?
  - positioning? should it always be at the bottom or should be users the ability to customize positioning freely?
- what about transitioning, should we allow customization of this?


## Additional Links

https://w3c.github.io/aria-practices/examples/alert/alert.html
https://github.com/adobe/react-spectrum/blob/main/specs/accessibility/Toast.mdx
https://spectrum.adobe.com/page/toast/
